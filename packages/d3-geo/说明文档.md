# d3-geo
地图投影有时也被称为坐标点变换，可以联想球面墨卡托投影的计算过程。

在数学意义上投影是连续空间到另一个连续空间的变换过程，但是由于计算机无法表现连续空间，因此需要抽象为离散的polygon和polyline。

## geodesics-大地线/测地线
将离散化的几何模型从球面空间投影到平面空间更加困难,球面多边形的"边"称之为geodesics。geodesics在任何地图投影过程都保存曲线状态，除非是gnomonic球心投影变换。

## Antimeridian-180°经线
多边形和多线段投影过程需要处理球面和平面的拓扑差异，一些投影算法需要处理cutting geometry。  
球面多边形需要根据`winding order convention`来决定多边形的正反面。`winding order convention`在TogoJSON和ESRI shapefiles这些数据交换格式中有明确定义

## GeoJSON & TopoJSON
d3使用GeoJSON格式来表示地理特征；而TopJSON是对GeoJSON的扩展，并且其编码更加紧凑。ESRI shapefiles和GeoJSON可以通过工具来相互转换
(1)Point-坐标点  
(2)MultiPoint-坐标数组  
(3)LineString-用于形成连续线段的坐标数组  
(4)MultiLineString-用于形成多条线段的坐标数组  
(5)polygon-二维坐标数组来描述多边形
(6)MultiPolygon-多维数组来描述多个多边形  
(7)GeometryCollection-几何对象数组
(8)Feature-可以包含上面7中类型的特征容器
(9)FeatureCollection-feature数组



## Paths
`d3.geoPath`根据给定的GeoJSON集合或者feature对象来生成地理路径，类似`d3-shape`模块来生成各类多边形路径一样。最终生成SVG path字符串或者渲染到Canvas上的字符串。

(1) path.area(object)
参数object是GeoJSON交换格式中定义的地理对象，注意GeoJSON中的point、line等对象的面积为0；而针对具有孔的polygon，先计算外部面积然后减去孔的面积

(2)path.bounds(object)
返回GeoJSON交换格式中的对象包围盒区域，[[x0,y0],[x1,y1]]。

(3)path.centroid(object)
在实际绘制地理标签时，一般需要将symbol定位到特定的地理区域中心。

(4)path.projection([projection])
参数`projection`是外部定义的投影算法，如果没有传递参数则d3默认的projection为null，相当于identity transform。

(5)path.context([context])
如果`context`参数指定，则设置渲染上下文为该参数，否则默认为SVG路径生成器
context.beginPath()  
context.moveTo(x,y)  
context.lineTo(x,y)  
context.arc(x,y,radius,startAngle,endAngle)  
context.closePath()

(6)path.pointRadius([radius])
如果设置了radius参数，则展示GeoJSON中的point或MultiPoint几何模型时设置特定半径，默认为4.5。

## Projection
地理投影变换用于将球面多边形映射为平面多边形。d3本身提供了一系列标准的投影算法
`Azimuthal`投影
`Composite`投影
`Conic`投影
`Cylindrical`投影
开发者可以通过d3.geoProjection或者d3.geoProjectionMutator来自定义投影算法
(1)projection(point)  
给定参数point表示球面点经纬度，返回[x,y]结构。
(2)projection.invert(point)  
参数为投影到平面上的[x,y]坐标点，返回球面上对应的经纬度点。







